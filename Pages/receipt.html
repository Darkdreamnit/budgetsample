<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Receipt Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        .receipt-paper {
            background: linear-gradient(to bottom, #fff 95%, #f0f0f0 100%);
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
        }
        .receipt-paper::after {
            content: "";
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80%;
            height: 1px;
            background: repeating-linear-gradient(to right, #000 0%, #000 50%, transparent 50%, transparent 100%);
            background-size: 10px 1px;
        }
        .item-row:hover {
            background-color: #f8fafc;
        }
        .dashed-border {
            border-top: 1px dashed #ccc;
        }
        @media print {
            .no-print {
                display: none !important;
            }
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <h1 class="text-3xl font-bold text-center text-blue-600 mb-2">Receipt Creator</h1>
            <p class="text-center text-gray-600 mb-8">Create professional receipts and export them as images</p>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                <!-- Input Form -->
                <div class="lg:col-span-2 bg-white rounded-lg shadow-md p-6 no-print">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Receipt Information</h2>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Business Name</label>
                            <input type="text" id="businessName" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Your Business Name">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Business Address (Optional)</label>
                            <input type="text" id="businessAddress" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="123 Business Street, City">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Receipt Number</label>
                            <input type="text" id="receiptNumber" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="REC-001">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Date</label>
                            <input type="date" id="receiptDate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Payment Method</label>
                            <select id="paymentMethod" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="Cash">Cash</option>
                                <option value="Credit Card">Credit Card</option>
                                <option value="Bank Transfer">Bank Transfer</option>
                                <option value="Mobile Payment">Mobile Payment</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Contact Info (Optional)</label>
                            <input type="text" id="businessContact" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Tel: (123) 456-7890">
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Customer Information</label>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <input type="text" id="customerName" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Customer Name">
                            <input type="text" id="customerPhone" class="px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Phone Number">
                        </div>
                        <textarea id="customerAddress" class="w-full mt-2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Customer Address (Optional)"></textarea>
                    </div>
                    
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-2">
                            <label class="block text-sm font-medium text-gray-700">Items</label>
                            <button id="addItemBtn" class="text-sm bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-md flex items-center">
                                <i class="fas fa-plus mr-1"></i> Add Item
                            </button>
                        </div>
                        
                        <div id="itemsContainer" class="border border-gray-200 rounded-md overflow-hidden">
                            <div class="grid grid-cols-12 bg-gray-50 p-2 border-b border-gray-200">
                                <div class="col-span-5 text-sm font-medium text-gray-700">Description</div>
                                <div class="col-span-2 text-sm font-medium text-gray-700 text-center">Qty</div>
                                <div class="col-span-2 text-sm font-medium text-gray-700 text-center">Price</div>
                                <div class="col-span-2 text-sm font-medium text-gray-700 text-center">Total</div>
                                <div class="col-span-1"></div>
                            </div>
                            <div id="itemRows">
                                <!-- Items will be added here -->
                            </div>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Tax Rate (%)</label>
                            <input type="number" id="taxRate" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="0" min="0" max="100">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Discount</label>
                            <input type="number" id="discount" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" value="0" min="0">
                        </div>
                    </div>
                    
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Additional Notes</label>
                        <textarea id="notes" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" rows="2" placeholder="Thank you for your business!"></textarea>
                    </div>
                    
                    <div class="flex flex-wrap gap-3">
                        <button id="generateBtn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md flex items-center">
                            <i class="fas fa-receipt mr-2"></i> Generate Receipt
                        </button>
                        <button id="resetBtn" class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-4 py-2 rounded-md flex items-center">
                            <i class="fas fa-redo mr-2"></i> Reset Form
                        </button>
                    </div>
                </div>
                
                <!-- Receipt Preview -->
                <div class="lg:col-span-1">
                    <div class="bg-white rounded-lg shadow-md p-4 sticky top-4">
                        <h2 class="text-xl font-semibold mb-4 text-gray-800">Receipt Preview</h2>
                        
                        <div id="receiptPreview" class="receipt-paper p-4 mb-4 mx-auto" style="width: 300px;">
                            <div class="text-center mb-2">
                                <h3 id="previewBusinessName" class="font-bold text-lg">Your Business</h3>
                                <p id="previewBusinessAddress" class="text-xs text-gray-600">123 Business Street, City</p>
                            </div>
                            
                            <div class="text-center text-xs mb-3">
                                <p id="previewBusinessContact">Tel: (123) 456-7890 | Email: info@business.com</p>
                            </div>
                            
                            <div class="dashed-border mb-3 pt-2">
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="font-medium">Receipt #:</span>
                                    <span id="previewReceiptNumber">REC-001</span>
                                </div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span class="font-medium">Date:</span>
                                    <span id="previewDate">Today</span>
                                </div>
                                <div class="flex justify-between text-sm">
                                    <span class="font-medium">Payment Method:</span>
                                    <span id="previewPaymentMethod">Cash</span>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <p class="text-sm font-medium">Customer:</p>
                                <p id="previewCustomerName" class="text-sm">John Doe</p>
                                <p id="previewCustomerPhone" class="text-sm">(555) 123-4567</p>
                            </div>
                            
                            <div class="border-t border-b border-gray-200 py-2 mb-3">
                                <div class="grid grid-cols-12 text-xs font-medium mb-1">
                                    <div class="col-span-6">Item</div>
                                    <div class="col-span-2 text-center">Qty</div>
                                    <div class="col-span-2 text-right">Price</div>
                                    <div class="col-span-2 text-right">Total</div>
                                </div>
                                <div id="previewItems">
                                    <!-- Items will be added here -->
                                    <div class="grid grid-cols-12 text-xs py-1">
                                        <div class="col-span-6 truncate">Sample Item</div>
                                        <div class="col-span-2 text-center">1</div>
                                        <div class="col-span-2 text-right">$10.00</div>
                                        <div class="col-span-2 text-right">$10.00</div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="text-right mb-3">
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Subtotal:</span>
                                    <span id="previewSubtotal">$10.00</span>
                                </div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Tax (<span id="previewTaxRate">0</span>%):</span>
                                    <span id="previewTaxAmount">$0.00</span>
                                </div>
                                <div class="flex justify-between text-sm mb-1">
                                    <span>Discount:</span>
                                    <span id="previewDiscount">$0.00</span>
                                </div>
                                <div class="flex justify-between font-medium">
                                    <span>Total:</span>
                                    <span id="previewTotal">$10.00</span>
                                </div>
                            </div>
                            
                            <div class="dashed-border pt-2 mb-2">
                                <p id="previewNotes" class="text-xs text-center italic">Thank you for your business!</p>
                            </div>
                            
                            <p class="text-xs text-center text-gray-600 mt-4">Please retain this receipt for your records</p>
                        </div>
                        
                        <div class="flex flex-col gap-2 no-print">
                            <button id="exportBtn" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-md flex items-center justify-center disabled:bg-gray-300" disabled>
                                <i class="fas fa-download mr-2"></i> Export as Image
                            </button>
                            <button id="printBtn" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-md flex items-center justify-center disabled:bg-gray-300" disabled>
                                <i class="fas fa-print mr-2"></i> Print Receipt
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Set today's date as default
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('receiptDate').value = today;
            
            // Add first item row
            addItemRow();
            
            // Event listeners
            document.getElementById('addItemBtn').addEventListener('click', function(e) {
                e.preventDefault();
                addItemRow();
            });
            
            document.getElementById('generateBtn').addEventListener('click', function(e) {
                e.preventDefault();
                generateReceipt();
            });
            
            document.getElementById('resetBtn').addEventListener('click', resetForm);
            document.getElementById('exportBtn').addEventListener('click', exportReceipt);
            document.getElementById('printBtn').addEventListener('click', printReceipt);
            
            // Live preview updates
            const inputFields = ['businessName', 'businessAddress', 'businessContact', 'receiptNumber', 'receiptDate', 
                                'paymentMethod', 'customerName', 'customerPhone', 'customerAddress', 'taxRate', 
                                'discount', 'notes'];
            
            inputFields.forEach(field => {
                document.getElementById(field).addEventListener('input', updatePreview);
            });
        });
        
        let itemCount = 0;
        
        function addItemRow() {
            itemCount++;
            const itemRows = document.getElementById('itemRows');
            
            const row = document.createElement('div');
            row.className = 'item-row grid grid-cols-12 p-2 border-b border-gray-200';
            row.id = `itemRow-${itemCount}`;
            
            row.innerHTML = `
                <div class="col-span-5">
                    <input type="text" class="item-desc w-full px-2 py-1 border border-gray-300 rounded text-sm focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="Item description">
                </div>
                <div class="col-span-2">
                    <input type="number" class="item-qty w-full px-2 py-1 border border-gray-300 rounded text-sm text-center focus:outline-none focus:ring-1 focus:ring-blue-500" value="1" min="1">
                </div>
                <div class="col-span-2">
                    <input type="number" step="0.01" class="item-price w-full px-2 py-1 border border-gray-300 rounded text-sm text-center focus:outline-none focus:ring-1 focus:ring-blue-500" placeholder="0.00">
                </div>
                <div class="col-span-2 flex items-center justify-end">
                    <span class="item-total text-sm pr-2">$0.00</span>
                </div>
                <div class="col-span-1 flex items-center justify-center">
                    <button class="remove-item text-red-500 hover:text-red-700 focus:outline-none" data-row="itemRow-${itemCount}">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            itemRows.appendChild(row);
            
            // Add event listeners for the new row
            const descInput = row.querySelector('.item-desc');
            const qtyInput = row.querySelector('.item-qty');
            const priceInput = row.querySelector('.item-price');
            
            [descInput, qtyInput, priceInput].forEach(input => {
                input.addEventListener('input', function() {
                    calculateItemTotal(row);
                    updatePreview();
                });
            });
            
            row.querySelector('.remove-item').addEventListener('click', function() {
                itemRows.removeChild(row);
                updatePreview();
            });
            
            // Focus on the new item description field
            row.querySelector('.item-desc').focus();
        }
        
        function calculateItemTotal(row) {
            const qty = parseFloat(row.querySelector('.item-qty').value) || 0;
            const price = parseFloat(row.querySelector('.item-price').value) || 0;
            const total = qty * price;
            
            row.querySelector('.item-total').textContent = `$${total.toFixed(2)}`;
            return total;
        }
        
        function calculateTotals() {
            const rows = document.querySelectorAll('#itemRows .item-row');
            let subtotal = 0;
            
            rows.forEach(row => {
                subtotal += calculateItemTotal(row);
            });
            
            const taxRate = parseFloat(document.getElementById('taxRate').value) || 0;
            const discount = parseFloat(document.getElementById('discount').value) || 0;
            
            const taxAmount = subtotal * (taxRate / 100);
            const total = subtotal + taxAmount - discount;
            
            return {
                subtotal: subtotal.toFixed(2),
                taxAmount: taxAmount.toFixed(2),
                discount: discount.toFixed(2),
                total: total.toFixed(2)
            };
        }
        
        function updatePreview() {
            // Business info
            document.getElementById('previewBusinessName').textContent = 
                document.getElementById('businessName').value || 'Your Business';
            document.getElementById('previewBusinessAddress').textContent = 
                document.getElementById('businessAddress').value || '123 Business Street, City';
            document.getElementById('previewBusinessContact').textContent = 
                document.getElementById('businessContact').value || 'Tel: (123) 456-7890';
            
            document.getElementById('previewReceiptNumber').textContent = 
                document.getElementById('receiptNumber').value || 'REC-001';
            
            // Format date
            const dateInput = document.getElementById('receiptDate').value;
            if (dateInput) {
                const date = new Date(dateInput);
                const options = { year: 'numeric', month: 'short', day: 'numeric' };
                document.getElementById('previewDate').textContent = date.toLocaleDateString(undefined, options);
            } else {
                document.getElementById('previewDate').textContent = 'Today';
            }
            
            document.getElementById('previewPaymentMethod').textContent = 
                document.getElementById('paymentMethod').value || 'Cash';
            
            // Customer info
            document.getElementById('previewCustomerName').textContent = 
                document.getElementById('customerName').value || 'John Doe';
            document.getElementById('previewCustomerPhone').textContent = 
                document.getElementById('customerPhone').value || '(555) 123-4567';
            
            // Items
            const previewItems = document.getElementById('previewItems');
            previewItems.innerHTML = '';
            
            const rows = document.querySelectorAll('#itemRows .item-row');
            if (rows.length === 0) {
                // Show sample item if no items exist
                previewItems.innerHTML = `
                    <div class="grid grid-cols-12 text-xs py-1">
                        <div class="col-span-6 truncate">Sample Item</div>
                        <div class="col-span-2 text-center">1</div>
                        <div class="col-span-2 text-right">$10.00</div>
                        <div class="col-span-2 text-right">$10.00</div>
                    </div>
                `;
            } else {
                rows.forEach(row => {
                    const desc = row.querySelector('.item-desc').value || 'Item';
                    const qty = row.querySelector('.item-qty').value || '1';
                    const price = parseFloat(row.querySelector('.item-price').value) || 0;
                    const total = parseFloat(row.querySelector('.item-total').textContent.replace('$', '')) || 0;
                    
                    const itemRow = document.createElement('div');
                    itemRow.className = 'grid grid-cols-12 text-xs py-1';
                    itemRow.innerHTML = `
                        <div class="col-span-6 truncate">${desc}</div>
                        <div class="col-span-2 text-center">${qty}</div>
                        <div class="col-span-2 text-right">$${price.toFixed(2)}</div>
                        <div class="col-span-2 text-right">$${total.toFixed(2)}</div>
                    `;
                    previewItems.appendChild(itemRow);
                });
            }
            
            // Totals
            const totals = calculateTotals();
            document.getElementById('previewSubtotal').textContent = `$${totals.subtotal}`;
            document.getElementById('previewTaxRate').textContent = document.getElementById('taxRate').value || '0';
            document.getElementById('previewTaxAmount').textContent = `$${totals.taxAmount}`;
            document.getElementById('previewDiscount').textContent = `$${totals.discount}`;
            document.getElementById('previewTotal').textContent = `$${totals.total}`;
            
            // Notes
            document.getElementById('previewNotes').textContent = 
                document.getElementById('notes').value || 'Thank you for your business!';
        }
        
        function generateReceipt() {
            updatePreview();
            document.getElementById('exportBtn').disabled = false;
            document.getElementById('printBtn').disabled = false;
            
            // Show success message
            const prevBtn = document.getElementById('generateBtn');
            const originalText = prevBtn.innerHTML;
            
            prevBtn.innerHTML = '<i class="fas fa-check mr-2"></i> Receipt Generated!';
            prevBtn.classList.remove('bg-blue-600', 'hover:bg-blue-700');
            prevBtn.classList.add('bg-green-600', 'hover:bg-green-700');
            
            setTimeout(() => {
                prevBtn.innerHTML = originalText;
                prevBtn.classList.remove('bg-green-600', 'hover:bg-green-700');
                prevBtn.classList.add('bg-blue-600', 'hover:bg-blue-700');
            }, 2000);
            
            // Scroll to preview
            document.getElementById('receiptPreview').scrollIntoView({ behavior: 'smooth' });
        }
        
        function resetForm() {
            document.getElementById('businessName').value = '';
            document.getElementById('businessAddress').value = '';
            document.getElementById('businessContact').value = '';
            document.getElementById('receiptNumber').value = '';
            document.getElementById('receiptDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('paymentMethod').value = 'Cash';
            document.getElementById('customerName').value = '';
            document.getElementById('customerPhone').value = '';
            document.getElementById('customerAddress').value = '';
            document.getElementById('taxRate').value = '0';
            document.getElementById('discount').value = '0';
            document.getElementById('notes').value = 'Thank you for your business!';
            
            document.getElementById('itemRows').innerHTML = '';
            addItemRow();
            
            document.getElementById('exportBtn').disabled = true;
            document.getElementById('printBtn').disabled = true;
            
            updatePreview();
        }
        
        function exportReceipt() {
            const receiptElement = document.getElementById('receiptPreview');
            
            html2canvas(receiptElement, {
                scale: 2,
                logging: false,
                useCORS: true,
                allowTaint: true,
                backgroundColor: '#ffffff'
            }).then(canvas => {
                const link = document.createElement('a');
                link.download = `receipt-${document.getElementById('receiptNumber').value || '001'}.png`;
                link.href = canvas.toDataURL('image/png');
                link.click();
            });
        }
        
        function printReceipt() {
            const receiptElement = document.getElementById('receiptPreview');
            const printWindow = window.open('', '', 'width=600,height=600');
            
            printWindow.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Print Receipt</title>
                    <style>
                        body {
                            font-family: Arial, sans-serif;
                            display: flex;
                            justify-content: center;
                            align-items: center;
                            height: 100vh;
                            margin: 0;
                            background: #fff;
                        }
                        .receipt-container {
                            transform: scale(1.2);
                            transform-origin: top center;
                        }
                        .receipt-paper {
                            background: white;
                            box-shadow: none;
                        }
                    </style>
                </head>
                <body>
                    <div class="receipt-container">
                        ${receiptElement.outerHTML}
                    </div>
                    <script>
                        window.onload = function() {
                            setTimeout(function() {
                                window.print();
                                window.close();
                            }, 200);
                        };
                    <\/script>
                </body>
                </html>
